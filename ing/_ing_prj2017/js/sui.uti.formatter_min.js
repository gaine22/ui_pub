/*
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 * 
 * Do Not Erase This Comment!!!
 * 
 * 본 프로그램의 모든 내용은 LG CNS "SmartChannelPlatform" 이하 SCP의 자산이므로 어떤한 경우라도 허락없이 재배포
 * 하거나 LG CNS 외부로의 유출이 금지되어 있습니다.
 * 
 * 프로젝트에서 SCP를 사용하거나 SCP를 변경한 경우 프로젝트 정보와 변경된 내용을 SCP 팀에 알려야 한다.
 */

/**
 * ****************************************************************************
 *  @module       : sui
 *  @version      : v1.1
 *  @fileName     : sui.uti.formatter.js
 *  @description  : SmartUI JavaScript Library 
 *  @author       : LG CNS SCP
 *  @dateCreated  : 2011.12.10
 * ----------------------------------------------------------------------------
 *  [ 변경내역 ]
 *  <ul>
 *    <li>2011.12.10 : 최초작성</li>
 *    <li>2012.05.03 : 파일분리</li>
 *    <li>2012.11.28 : 배포버전 최초 작성</li>
 *    <li>2013.02.25 : 안드로이드 체크로직 core단으로 이관</li>    
 *    <li>2013.07.19 : number Type 추가 (formatting)</li>    
 *  </ul>
 **/
(function(){var a=function(c){var d=sui.env;var e={};e.IS_IPHONE=(window.orientation!=undefined?true:false);e.DEFINITION={regularExp:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};e.getFormateValue=function(h,f){var g=h;var j=f.mask;try{if(f.type&&f.type==="unfomatter"){j=d.get("unformatter.rule")[f.mask]}else{j=d.get("formatter.rule")[f.mask]}if(!j){j=f.mask}}catch(i){}if(typeof j==="function"){if(f.replaceValue){g=j.call(j,h,f.options)}else{h.on("keyup",function(k){h.val(j.call(j,h.val(),f.options,k))});h.val(j.call(j,h.val(),f.options,null));g=h.val()}}else{var f=$.extend({mask:"",placeholder:"_",completed:null},f);f.firstFocusPos=null;f.buffer="";f.tests=[];f.maskLength=f.mask.length;f.temp=new Object();if(f.replaceValue){f.placeholder=" ";e.getRegExecFormateValue.init(h,f);g=e.getRegExecFormateValue.inspection(h,f)}else{e.getRegExecFormateValue.init(h,f);g=e.getRegExecFormateValue.inspection(h,f);if(!h.attr("readonly")){h.on("focus",function(){f.temp=new Object();e.getRegExecFormateValue.focus(h,f)}).on("blur",function(){f.temp=new Object();e.getRegExecFormateValue.inspection(h,f)}).on("keydown",function(k){if(sui.uti.check.isAndroid&&!!f.temp.value){this.value=f.temp.value;this.setSelectionRange(f.temp.start,f.temp.end)}return e.getRegExecFormateValue.inputText_down(h,f,k)}).on("keypress",function(k){if(sui.uti.check.isAndroid&&!!f.temp.value){this.value=f.temp.value;this.setSelectionRange(f.temp.start,f.temp.end)}return e.getRegExecFormateValue.inputText_press(h,f,k)}).on("click",function(k){f.temp=new Object()})}}}return g};e.getRegExecFormateValue={init:function(f,g){$.each(g.mask.split(""),function(h,i){if(e.DEFINITION.regularExp[i]){g.tests.push(new RegExp(e.DEFINITION.regularExp[i]));if(g.firstFocusPos==null){g.firstFocusPos=g.tests.length-1}}else{g.tests.push(null)}});g.buffer=$.map(g.mask.split(""),function(i,h){if(i!="?"){return(e.DEFINITION.regularExp[i]?g.placeholder:i)}})},selectRange:function(h,i,j,f){if(h.length==0){return}if(typeof j=="number"){f=(typeof f=="number")?f:j;return h.each(function(){if(this.setSelectionRange){this.focus();if(sui.uti.check.isAndroid){var l=this;setTimeout(function(){l.setSelectionRange(j,f)},0);i.temp.start=j;i.temp.end=f;i.temp.value=this.value}else{this.setSelectionRange(j,f)}}else{if(this.createTextRange){var k=this.createTextRange();k.collapse(true);k.moveEnd("character",f);k.moveStart("character",j);k.select()}}})}else{if(h[0].setSelectionRange){j=h[0].selectionStart;f=h[0].selectionEnd}else{if(document.selection&&document.selection.createRange){var g=document.selection.createRange();j=0-g.duplicate().moveStart("character",-100000);f=j+g.text.length}}return{start:j,end:f}}},inspection:function(f,k){var n=(typeof f==="string"?f:f.val());var m=-1;for(var h=0,l=0,g=n.length;h<k.maskLength;h++){if(k.tests[h]){k.buffer[h]=k.placeholder;while(l++<g){var j=n.charAt(l-1);if(k.tests[h].test(j)){k.buffer[h]=j;m=h;break}}if(l>g){break}}else{if(k.buffer[h]==n.charAt(l)&&h!=k.maskLength){l++;m=h}}}if(typeof f==="string"){return k.buffer.join("")}else{if(m+1<k.maskLength){f.val("");e.getRegExecFormateValue.clearBuffer(f,k,0,k.maskLength)}else{if(m+1>=k.maskLength){e.getRegExecFormateValue.applyBufferToTarget(f,k);f.val(f.val().substring(0,m+1))}}return(k.maskLength?h:k.firstFocusPos)}},focus:function(g,h){firstText=g.val();var i=e.getRegExecFormateValue.inspection(g,h);e.getRegExecFormateValue.applyBufferToTarget(g,h);g.val(h.buffer.join(""));var f=function(){if(i==h.maskLength){e.getRegExecFormateValue.selectRange(g,h,0,i)}else{e.getRegExecFormateValue.selectRange(g,h,i)}};(navigator.userAgent.indexOf("MSIE")>-1?f:function(){setTimeout(f,0)})()},clearBuffer:function(g,j,k,f){for(var h=k;h<f&&h<j.maskLength;h++){if(j.tests[h]){j.buffer[h]=j.placeholder}}},applyBufferToTarget:function(f,g){return f.val(g.buffer.join("")).val()},seekPrev:function(f,g,h){while(--h>=0&&!g.tests[h]){}return h},seekNext:function(f,g,h){while(++h<=g.maskLength&&!g.tests[h]){}return h},shiftL:function(h,l,m,f){if(m<0){return}for(var k=m,g=e.getRegExecFormateValue.seekNext(h,l,f);k<l.maskLength;k++){if(l.tests[k]){if(g<l.maskLength&&l.tests[k].test(l.buffer[g])){l.buffer[k]=l.buffer[g];l.buffer[g]=l.placeholder}else{break}g=e.getRegExecFormateValue.seekNext(h,l,g)}}e.getRegExecFormateValue.applyBufferToTarget(h,l);e.getRegExecFormateValue.selectRange(h,l,Math.max(l.firstFocusPos,m))},shiftR:function(g,l,n){for(var k=n,m=l.placeholder;k<l.maskLength;k++){if(l.tests[k]){var f=e.getRegExecFormateValue.seekNext(g,l,k);var h=l.buffer[k];l.buffer[k]=m;if(f<l.maskLength&&l.tests[f].test(h)){m=h}else{break}}}},inputText_down:function(h,i,j){var g=j.which;if(g==8||g==46||(e.IS_IPHONE&&g==127)){var m=e.getRegExecFormateValue.selectRange(h,i),l=m.start,f=m.end;if(f-l==0){l=g!=46?e.getRegExecFormateValue.seekPrev(h,i,l):(f=e.getRegExecFormateValue.seekNext(h,i,l-1));f=g==46?e.getRegExecFormateValue.seekNext(h,i,f):f}e.getRegExecFormateValue.clearBuffer(h,i,l,f);e.getRegExecFormateValue.shiftL(h,i,l,f-1);return false}else{if(g==27){h.val(focusText);e.getRegExecFormateValue.selectRange(h,i,0,e.getRegExecFormateValue.inspection(h,i));return false}}},inputText_press:function(g,i,l){var f=l.which,n=e.getRegExecFormateValue.selectRange(g,i);if(l.ctrlKey||l.altKey||l.metaKey||f<32){return true}else{if(f){if(n.end-n.start!=0){e.getRegExecFormateValue.clearBuffer(g,i,n.start,n.end);e.getRegExecFormateValue.shiftL(g,i,n.start,n.end-1)}var j=e.getRegExecFormateValue.seekNext(g,i,n.start-1);if(j<i.maskLength){var m=String.fromCharCode(f);if(i.tests[j].test(m)){e.getRegExecFormateValue.shiftR(g,i,j);i.buffer[j]=m;e.getRegExecFormateValue.applyBufferToTarget(g,i);var h=e.getRegExecFormateValue.seekNext(g,i,j);e.getRegExecFormateValue.selectRange(g,i,h);if(i.completed&&h>=i.maskLength){i.completed.call(g)}}else{if(sui.uti.check.isAndroid){i.temp.start=n.start;i.temp.end=n.end;i.temp.value=g[0].value}}}return false}}}};return function(){var k=arguments[0];if(k.length==1){var f=k[0];var l=null;if(Object.prototype.toString.call(f)!=="[object Array]"){f=[f]}var j="id";for(var h=0;h<f.length;h+=1){(function(i){if(f[i].id){l=$("#"+f[i].id);j="id"}else{if(f[i].name){l=$('[name="'+f[i].name+'"]');j="name"}else{if(f[i].className){l=$("."+f[i].className);j="className"}else{if(f[i].selector){l=$(f[i].selector);j="selector"}}}}if(!l[0]){alert(j+" : ["+f[i][j]+"] does not exist.");return false}e.getFormateValue(l,f[i])}(h))}}else{if(k.length==2){var g=k[0];var f=k[1];if(typeof(g)==="string"&&typeof(f)==="object"){f.replaceValue=true;return e.getFormateValue(g,f)}else{if(typeof(g)==="number"&&typeof(f)==="object"){f.replaceValue=true;return e.getFormateValue(g,f)}else{if(typeof(g)==="object"&&typeof(f)==="object"){e.getFormateValue(g,f)}}}}}}(arguments)};var b=function(c){var d=sui.env;return function(){var f=arguments[0];if(f.length==2){var e=f[1].mask;var g=d.get("formatter.rule")[e];if(!g){e=e.replace(/[^9a*]/gi,"")}f[1].mask=e;f[1].type="unfomatter"}return a.apply(null,arguments[0])}(arguments)};(function(c){jQuery.fn.formatter=function(d){return this.each(function(){sui.uti.formatter(c(this),d)})}})(jQuery);sui.addModule("sui.uti.formatter",a);sui.addModule("sui.uti.unformatter",b)}());